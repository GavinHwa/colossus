<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Metrics</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Colossus IO Framework: Built at Tumblr">
    <link rel="canonical" href="https://github.com/tumblr/colossushttps://tumblr.github.io/colossus/docs/metrics/">

    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <meta http-equiv="imagetoolbar" content="no" />
    <link rel="stylesheet" href="https://tumblr.github.io/colossus/css/layout.css" type="text/css" />
    <script type="text/javascript" src="https://tumblr.github.io/colossus/js/jquery.js"></script>
    <script type="text/javascript" src="https://tumblr.github.io/colossus/js/jquery.innerfade.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>

</head>

</head>


    <body>

    <div class="wrapper col1">
  <div id="header">
    <div id="logo">
      <h1><a href="https://tumblr.github.io/colossus/">Colossus</a></h1>
    </div>
    <div id="topnav">
      <ul>
        <li><a href="https://tumblr.github.io/colossus/about">About</a></li>
        <li><a href="https://tumblr.github.io/colossus/">Community</a></li>
        <li><a href="https://tumblr.github.io/colossus/docs">Documentation</a></li>
        <li><a href="https://github.com/tumblr/colossus">Github</a></li>
      </ul>
    </div>
    <br class="clear" />
  <p class="breaking-news"><b>Notice</b>: These docs are a work in progress.  If you see an error, <a href="https://github.com/tumblr/colossus/tree/gh-pages-source">fix it</a>!</p>
  </div>
</div>



        <div class="wrapper col3">
    <div id="container">
      <header class="post-header">
        <h1>Metrics</h1>
      </header>
      <div id="content">
        <article class="post-content">
        <p>Colossus uses the (currently nameless) metrics library.</p>

<h2 id="introduction">Introduction</h2>

<p>High-throughput Colossus services can serve hundreds of thousands of requests
per second, which can easily translate to millions of recordable events per
second.  The Metrics library provides a way to work with metrics with as little
overhead as possible.</p>

<h3 id="aggregation-intervals">Aggregation Intervals</h3>

<p>Aggregation intervals define how often the raw data from all event collectors
are snapshotted and merged together into a single database of values.</p>

<p>By default, a metric system is created with both 1 second and 1 minute
aggregation intervals.  The idea here is the 1 second interval is used to show
real-time metrics where rates and histograms are all showing values reflective
of the last second of activity, whereas the 1 minute intervals are used for
reporting values to an external database in which case the values reported are
all reflective of the last minute of activity.</p>

<h2 id="getting-started">Getting Started</h2>

<p>If you are using colossus, it depends on the metrics library and pulls it in.  Otherwise you must add the following to your build.sbt/Build.scala</p>

<div class="highlight"><pre><code class="scala"><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.tumblr"</span> <span class="o">%%</span> <span class="s">"colossus-metrics"</span> <span class="o">%</span> <span class="s">"0.7.0"</span></code></pre></div>

<p>From there, the only required step is to spin up a <code>MetricSystem</code></p>

<div class="highlight"><pre><code class="scala"><span class="k">import</span> <span class="nn">akka.actor._</span>
<span class="k">import</span> <span class="nn">metrics._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">actor_system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>

<span class="c1">//create the metric system
</span><span class="k">val</span> <span class="n">metric_system</span> <span class="k">=</span> <span class="nc">MetricSystem</span><span class="o">(</span><span class="s">"/my-service"</span><span class="o">)</span></code></pre></div>

<h2 id="metric-reporting">Metric Reporting</h2>

<p>Currently metric reporting is mostly focused on reporting to OpenTSDB.  To setup reporting you basically need 2 things:</p>

<ul>
  <li>A MetricSender - this is the object that encodes metrics to be sent</li>
  <li>A set of metric filters - These are used to select and aggregate which metrics to send</li>
</ul>

<p>In addition to OpenTSDB, metrics may also be logged to file. To use logging, change the MetricSystem to use
a LoggingSender as the metrics reporter:</p>

<div class="highlight"><pre><code class="scala"><span class="k">import</span> <span class="nn">akka.actor._</span>
<span class="k">import</span> <span class="nn">metrics._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">actor_system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>

<span class="c1">//create the metric system
</span><span class="k">val</span> <span class="n">metric_system</span> <span class="k">=</span> <span class="nc">MetricSystem</span><span class="o">(</span><span class="s">"/my-service"</span><span class="o">)</span>

<span class="c1">//create the config, providing LoggerSender as the MetricSender
</span><span class="k">val</span> <span class="n">metric_config</span> <span class="k">=</span> <span class="nc">MetricReporterConfig</span><span class="o">(</span><span class="nc">LoggerSender</span><span class="o">)</span>

<span class="c1">//set this as the reporting for the metric system
</span><span class="n">metric_system</span><span class="o">.</span><span class="n">metricIntervals</span><span class="o">(</span><span class="mf">1.</span><span class="n">minute</span><span class="o">).</span><span class="n">report</span><span class="o">(</span><span class="n">metric_config</span><span class="o">)</span>

<span class="c1">//get a collection
</span><span class="k">val</span> <span class="n">collection</span> <span class="k">=</span> <span class="n">metric_system</span><span class="o">.</span><span class="n">sharedCollection</span>

<span class="o">//</span><span class="n">proceed</span> <span class="n">as</span> <span class="n">normal</span></code></pre></div>


        </article>
      </div>
      <div id="column">
        <div class="subnav">
          <ol class="toc"><li><a href="#introduction">Introduction</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#metric-reporting">Metric Reporting</a></li></ol>
        </div>
      </div>
      <br class="clear" />
    </div>
  </div>
  <br class="clear" />



    <footer id = "footer" class="site-footer">

<div class="wrapper col5">
  <div id="copyright">
    <p class="fl_left">Copyright &copy; 2016 Tumblr - All Rights Reserved <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/80x15.png" /></a></p>
    <p class="fl_right">Based on a template by <a href="http://www.os-templates.com/" title="Free Website Templates">OS Templates</a></p>
    <br class="clear" />
  </div>
</div>

</footer>


    </body>
</html>
